name: Create Repositories with Workflows

on:
  workflow_dispatch:  # Allows manual trigger

jobs:
  create_repos:
    runs-on: ubuntu-latest

    steps:
      - name: Setup Git Config
        run: |
          git config --global user.email "lalittanysudhakar@gmail.com"
          git config --global user.name "lalitsudhakar"

      - name: Create Repositories
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
          ORG_NAME: "lalitsudhakar"
        run: |
          REPOS=("finance" "analytics" "automation" "security" "java" "python" "business" "marketing")

          for REPO in "${REPOS[@]}"; do
            echo "Creating repository: $REPO"
            
            # Create the repository
            RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" -X POST \
              -H "Authorization: token $GH_TOKEN" \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/user/repos \
              -d "{\"name\": \"$REPO\", \"private\": false}")

            if [[ "$RESPONSE" != "201" ]]; then
              echo "âŒ Error creating repo: $REPO (HTTP $RESPONSE)"
              continue
            fi

            sleep 2

            # Clone, add files, and push
            git clone https://$GH_PAT@github.com/$ORG_NAME/$REPO.git && cd $REPO

            # Add a dummy Python script
            echo 'print("Hello from Dummy Repo")' > main.py
            git add main.py
            git commit -m "Added dummy Python script"
            git push origin main

            # Add GitHub Actions workflow
            mkdir -p .github/workflows
            echo "name: CI for $REPO

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      - name: Run Script
        run: echo \"Building $REPO\"" > .github/workflows/main.yml

            git add .github/workflows/main.yml
            git commit -m "Added workflow for $REPO"
            git push origin main

            cd ..
            rm -rf $REPO  # Clean up local repo
          done
